import{t as M,a as S,c as _n}from"../chunks/Bq-qZP5W.js";import{i as bn}from"../chunks/DPZoJjUy.js";import{M as aa,h as we,W as wn,V as yn,J as En,b as jn,k as t,af as Ft,K as kn,L as Ya,N as ra,c as kt,a7 as Cn,O as Ga,a as Ja,P as Sn,as as Xa,ab as Qa,I as Mn,ai as Tn,A as Ra,at as na,T as Dn,F as Ha,au as da,av as Ln,aw as ua,ax as Va,ay as zn,aa as In,az as An,d as xn,aA as Nn,a5 as Pn,aB as $n,aC as Fn,H as On,aD as Un,aE as Yn,i as Rn,R as Hn,Q as er,q as Vn,aF as y,aG as oa,aH as Wn,s as Bn,aI as Zn,v as u,w as v,C as a,x as h,t as x,f as sa,ar as Kn,aJ as qn,aK as Gn}from"../chunks/CJfivAtN.js";import{a as Jn,l as tr,e as L,s as V}from"../chunks/Cgl63eWk.js";import{a as Xn,i as le,b as Qn}from"../chunks/BbNp6bIf.js";import{o as eo}from"../chunks/CKN_Wylj.js";function Fe(r,s){return s}function to(r,s,o,i){for(var c=[],p=s.length,m=0;m<p;m++)zn(s[m].e,c,!0);var k=p>0&&c.length===0&&o!==null;if(k){var q=o.parentNode;In(q),q.append(o),i.clear(),Ge(r,s[0].prev,s[p-1].next)}An(c,()=>{for(var B=0;B<p;B++){var O=s[B];k||(i.delete(O.k),Ge(r,O.prev,O.next)),xn(O.e,!k)}})}function me(r,s,o,i,c,p=null){var m=r,k={flags:s,items:new Map,first:null},q=(s&Xa)!==0;if(q){var B=r;m=we?aa(wn(B)):B.appendChild(yn())}we&&En();var O=null,Ye=!1,T=Ft(()=>{var N=o();return Mn(N)?N:N==null?[]:Qa(N)});jn(()=>{var N=t(T),_=N.length;if(Ye&&_===0)return;Ye=_===0;let ce=!1;if(we){var W=m.data===kn;W!==(_===0)&&(m=Ya(),aa(m),ra(!1),ce=!0)}if(we){for(var G=null,z,Z=0;Z<_;Z++){if(kt.nodeType===8&&kt.data===Cn){m=kt,ce=!0,ra(!1);break}var C=N[Z],D=i(C,Z);z=ar(kt,k,G,null,C,D,Z,c,s,o),k.items.set(D,z),G=z}_>0&&aa(Ya())}we||ao(N,k,m,c,s,i,o),p!==null&&(_===0?O?Ga(O):O=Ja(()=>p(m)):O!==null&&Sn(O,()=>{O=null})),ce&&ra(!0),t(T)}),we&&(m=kt)}function ao(r,s,o,i,c,p,m){var De,ye,_e,ve;var k=(c&Ln)!==0,q=(c&(ua|da))!==0,B=r.length,O=s.items,Ye=s.first,T=Ye,N,_=null,ce,W=[],G=[],z,Z,C,D;if(k)for(D=0;D<B;D+=1)z=r[D],Z=p(z,D),C=O.get(Z),C!==void 0&&((De=C.a)==null||De.measure(),(ce??(ce=new Set)).add(C));for(D=0;D<B;D+=1){if(z=r[D],Z=p(z,D),C=O.get(Z),C===void 0){var Qe=T?T.e.nodes_start:o;_=ar(Qe,s,_,_===null?s.first:_.next,z,Z,D,i,c,m),O.set(Z,_),W=[],G=[],T=_.next;continue}if(q&&ro(C,z,D,c),C.e.f&na&&(Ga(C.e),k&&((ye=C.a)==null||ye.unfix(),(ce??(ce=new Set)).delete(C))),C!==T){if(N!==void 0&&N.has(C)){if(W.length<G.length){var P=G[0],j;_=P.prev;var Re=W[0],ge=W[W.length-1];for(j=0;j<W.length;j+=1)Wa(W[j],P,o);for(j=0;j<G.length;j+=1)N.delete(G[j]);Ge(s,Re.prev,ge.next),Ge(s,_,Re),Ge(s,ge,P),T=P,_=ge,D-=1,W=[],G=[]}else N.delete(C),Wa(C,T,o),Ge(s,C.prev,C.next),Ge(s,C,_===null?s.first:_.next),Ge(s,_,C),_=C;continue}for(W=[],G=[];T!==null&&T.k!==Z;)T.e.f&na||(N??(N=new Set)).add(T),G.push(T),T=T.next;if(T===null)continue;C=T}W.push(C),_=C,T=C.next}if(T!==null||N!==void 0){for(var $=N===void 0?[]:Qa(N);T!==null;)T.e.f&na||$.push(T),T=T.next;var K=$.length;if(K>0){var re=c&Xa&&B===0?o:null;if(k){for(D=0;D<K;D+=1)(_e=$[D].a)==null||_e.measure();for(D=0;D<K;D+=1)(ve=$[D].a)==null||ve.fix()}to(s,$,re,O)}}k&&Dn(()=>{var ne;if(ce!==void 0)for(C of ce)(ne=C.a)==null||ne.apply()}),Ha.first=s.first&&s.first.e,Ha.last=_&&_.e}function ro(r,s,o,i){i&ua&&Va(r.v,s),i&da?Va(r.i,o):r.i=o}function ar(r,s,o,i,c,p,m,k,q,B){var O=(q&ua)!==0,Ye=(q&Nn)===0,T=O?Ye?Tn(c):Ra(c):c,N=q&da?Ra(m):m,_={i:N,v:T,k:p,a:null,e:null,prev:o,next:i};try{return _.e=Ja(()=>k(r,T,N,B),we),_.e.prev=o&&o.e,_.e.next=i&&i.e,o===null?s.first=_:(o.next=_,o.e.next=_.e),i!==null&&(i.prev=_,i.e.prev=_.e),_}finally{}}function Wa(r,s,o){for(var i=r.next?r.next.e.nodes_start:o,c=s?s.e.nodes_start:o,p=r.e.nodes_start;p!==i;){var m=Pn(p);c.before(p),p=m}}function Ge(r,s,o){s===null?r.first=o:(s.next=o,s.e.next=o&&o.e),o!==null&&(o.prev=s,o.e.prev=s&&s.e)}const Ba=[...` 	
\r\f \v\uFEFF`];function no(r,s,o){var i=r==null?"":""+r;if(s&&(i=i?i+" "+s:s),o){for(var c in o)if(o[c])i=i?i+" "+c:c;else if(i.length)for(var p=c.length,m=0;(m=i.indexOf(c,m))>=0;){var k=m+p;(m===0||Ba.includes(i[m-1]))&&(k===i.length||Ba.includes(i[k]))?i=(m===0?"":i.substring(0,m))+i.substring(k+1):m=k}}return i===""?null:i}function Ke(r,s,o,i,c,p){var m=r.__className;if(we||m!==o){var k=no(o,i,p);(!we||k!==r.getAttribute("class"))&&(k==null?r.removeAttribute("class"):r.className=k),r.__className=o}else if(p){c??(c={});for(var q in p){var B=!!p[q];B!==!!c[q]&&r.classList.toggle(q,B)}}return p}function Oe(r){if(we){var s=!1,o=()=>{if(!s){if(s=!0,r.hasAttribute("value")){var i=r.value;Me(r,"value",null),r.value=i}if(r.hasAttribute("checked")){var c=r.checked;Me(r,"checked",null),r.checked=c}}};r.__on_r=o,$n(o),Jn()}}function oo(r,s){var o=r.__attributes??(r.__attributes={});o.checked!==(o.checked=s??void 0)&&(r.checked=s)}function Me(r,s,o,i){var c=r.__attributes??(r.__attributes={});we&&(c[s]=r.getAttribute(s),s==="src"||s==="srcset"||s==="href"&&r.nodeName==="LINK")||c[s]!==(c[s]=o)&&(s==="style"&&"__styles"in r&&(r.__styles={}),s==="loading"&&(r[Fn]=o),o==null?r.removeAttribute(s):typeof o!="string"&&so(r).includes(s)?r[s]=o:r.setAttribute(s,o))}var Za=new Map;function so(r){var s=Za.get(r.nodeName);if(s)return s;Za.set(r.nodeName,s=[]);for(var o,i=r,c=Element.prototype;c!==i;){o=Un(i);for(var p in o)o[p].set&&s.push(p);i=On(i)}return s}function qe(r,s,o=s){var i=Yn();tr(r,"input",c=>{var p=c?r.defaultValue:r.value;if(p=ia(r)?la(p):p,o(p),i&&p!==(p=s())){var m=r.selectionStart,k=r.selectionEnd;r.value=p??"",k!==null&&(r.selectionStart=m,r.selectionEnd=Math.min(k,r.value.length))}}),(we&&r.defaultValue!==r.value||Rn(s)==null&&r.value)&&o(ia(r)?la(r.value):r.value),Hn(()=>{var c=s();ia(r)&&c===la(r.value)||r.type==="date"&&!c&&!r.value||c!==r.value&&(r.value=c??"")})}function ia(r){var s=r.type;return s==="number"||s==="range"}function la(r){return r===""?null:+r}function rr(r,s,o){if(r.multiple)return co(r,s);for(var i of r.options){var c=Ct(i);if(Xn(c,s)){i.selected=!0;return}}(!o||s!==void 0)&&(r.selectedIndex=-1)}function io(r,s){er(()=>{var o=new MutationObserver(()=>{var i=r.__value;rr(r,i)});return o.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{o.disconnect()}})}function lo(r,s,o=s){var i=!0;tr(r,"change",c=>{var p=c?"[selected]":":checked",m;if(r.multiple)m=[].map.call(r.querySelectorAll(p),Ct);else{var k=r.querySelector(p)??r.querySelector("option:not([disabled])");m=k&&Ct(k)}o(m)}),er(()=>{var c=s();if(rr(r,c,i),i&&c===void 0){var p=r.querySelector(":checked");p!==null&&(c=Ct(p),o(c))}r.__value=c,i=!1}),io(r)}function co(r,s){for(var o of r.options)o.selected=~s.indexOf(Ct(o))}function Ct(r){return"__value"in r?r.__value:r.value}function vo(r){return function(...s){var o=s[0];return o.preventDefault(),r==null?void 0:r.apply(this,s)}}const nr=globalThis.__sveltekit_y5jp3o.env;class fa extends Error{constructor(s){super(s),this.name="UnauthorizedError"}}var qa;const Te=(qa=nr.PUBLIC_SUPABASE_FUNCTIONS_URL)==null?void 0:qa.replace(/\/$/,""),or=nr.PUBLIC_SUPABASE_ANON_KEY,uo="x-calendar-auth";let va=null;const Ie=()=>{const r={Authorization:`Bearer ${or}`,"Content-Type":"application/json"};return va&&(r[uo]=`Bearer ${va}`),r},ca=r=>{va=r};function Ae(){if(!Te)throw new Error("PUBLIC_SUPABASE_FUNCTIONS_URL non configurato");if(!or)throw new Error("PUBLIC_SUPABASE_ANON_KEY non configurato")}async function Ue(r){const s=await r.text();let o;try{o=s?JSON.parse(s):void 0}catch{throw new Error("Risposta non valida dal server")}if(!r.ok){const i=typeof o=="object"&&o!==null&&"error"in o?String(o.error):`Richiesta fallita con status ${r.status}`,c=typeof o=="object"&&o!==null&&"details"in o?o.details:null,p=Array.isArray(c)&&c.length>0?`${i}: ${c.join(" · ")}`:i;throw r.status===401?new fa(p):new Error(p)}return o}async function fo(r){var s;Ae();try{const o=await fetch(`${Te}/login`,{method:"POST",headers:Ie(),body:JSON.stringify({password:r})}),i=await Ue(o),c=(s=i==null?void 0:i.data)==null?void 0:s.token;if(!c)throw new Error("Risposta inattesa dal server");return c}catch(o){throw o instanceof Error?o:new Error("Impossibile effettuare il login")}}async function ho(r,s){Ae();try{const o=await fetch(`${Te}/get-week/year/${encodeURIComponent(r)}/week/${encodeURIComponent(s)}`,{headers:Ie()}),i=await Ue(o);if(!(i!=null&&i.data)||!Array.isArray(i.data))throw new Error("Formato della risposta non riconosciuto");return i.data}catch(o){throw o instanceof Error?o:new Error("Impossibile caricare gli eventi della settimana")}}async function po(r){Ae();try{const s=await fetch(`${Te}/post-event`,{method:"POST",headers:Ie(),body:JSON.stringify(r)}),o=await Ue(s);if(!(o!=null&&o.data))throw new Error("Risposta inattesa durante la creazione dell'evento");return o.data}catch(s){throw s instanceof Error?s:new Error("Impossibile creare l'evento")}}async function mo(r){Ae();try{const s=await fetch(`${Te}/patch-event`,{method:"PATCH",headers:Ie(),body:JSON.stringify(r)}),o=await Ue(s);if(!(o!=null&&o.data))throw new Error("Risposta inattesa durante l'aggiornamento dell'evento");return o.data}catch(s){throw s instanceof Error?s:new Error("Impossibile aggiornare l'evento")}}async function go(r){Ae();try{const s=await fetch(`${Te}/delete-event?id=${encodeURIComponent(r)}`,{method:"DELETE",headers:Ie()}),o=await Ue(s);if(!(o!=null&&o.data))throw new Error("Risposta inattesa durante l'eliminazione dell'evento");return o.data}catch(s){throw s instanceof Error?s:new Error("Impossibile eliminare l'evento")}}const _o={paziente:"paziente",prestazione:"prestazione",luogo:"luogo"};async function ha(r,s){Ae();const o=new URL(`${Te}/patient-autocomplete`);o.searchParams.set("field",_o[r]),o.searchParams.set("limit","10"),s.trim().length>0&&o.searchParams.set("q",s.trim());const i=await fetch(o.toString(),{method:"GET",headers:Ie()});if(i.status===401)throw new fa("Sessione non valida");if(!i.ok){const m=await i.json().catch(()=>null),k=m&&typeof m.error=="string"?m.error:"Impossibile recuperare i suggerimenti";throw new Error(k)}const c=await i.json();return(Array.isArray(c==null?void 0:c.data)?c.data:[]).filter(m=>typeof m=="string").map(m=>m.trim()).filter(m=>m.length>0)}const bo=r=>ha("paziente",r),wo=r=>ha("prestazione",r),yo=r=>ha("luogo",r);async function Eo(r="",s=10){Ae();try{const o=new URLSearchParams;r.trim()&&o.set("q",r.trim()),o.set("limit",String(s));const i=await fetch(`${Te}/get-paziente?${o.toString()}`,{headers:Ie()}),c=await Ue(i);return(c==null?void 0:c.data)??[]}catch(o){throw o instanceof Error?o:new Error("Impossibile recuperare i pazienti")}}async function Ka(r){if(Ae(),!r.length)return[];try{const s=await fetch(`${Te}/get-paziente?ids=${encodeURIComponent(r.join(","))}`,{headers:Ie()}),o=await Ue(s);return(o==null?void 0:o.data)??[]}catch(s){throw s instanceof Error?s:new Error("Impossibile recuperare i pazienti")}}async function jo(r){Ae();try{const s=await fetch(`${Te}/post-paziente`,{method:"POST",headers:Ie(),body:JSON.stringify(r)}),o=await Ue(s);if(!(o!=null&&o.data))throw new Error("Risposta inattesa durante la creazione del paziente");return o.data}catch(s){throw s instanceof Error?s:new Error("Impossibile creare il paziente")}}async function ko(r,s){Ae();try{const o=await fetch(`${Te}/patch-paziente`,{method:"PATCH",headers:Ie(),body:JSON.stringify({id:r,...s})}),i=await Ue(o);if(!(i!=null&&i.data))throw new Error("Risposta inattesa durante l'aggiornamento del paziente");return i.data}catch(o){throw o instanceof Error?o:new Error("Impossibile aggiornare il paziente")}}var Co=M('<div class="login-error svelte-12je5va" role="alert"> </div>'),So=M('<div class="login-container svelte-12je5va"><form class="login-card svelte-12je5va"><h1 class="svelte-12je5va">Calendario</h1> <p class="svelte-12je5va">Inserisci la password per continuare.</p> <label class="login-field svelte-12je5va"><span class="svelte-12je5va">Password</span> <input type="password" autocomplete="current-password" required class="svelte-12je5va"></label> <!> <button class="login-button svelte-12je5va" type="submit"> </button></form></div>'),Mo=M('<div class="status-banner status-error svelte-12je5va" role="alert"> </div>'),To=M('<div class="status-banner status-info svelte-12je5va" role="status" aria-live="polite">Caricamento…</div>'),Do=M('<div><div class="svelte-12je5va"> </div> <div class="day-number svelte-12je5va"> </div></div>'),Lo=M('<div class="time-slot svelte-12je5va"> </div>'),zo=M('<div class="hour-row svelte-12je5va"></div>'),Io=M('<button type="button"><span class="event-title svelte-12je5va"> </span> <span class="event-time svelte-12je5va"> </span></button>'),Ao=M('<div class="day-column svelte-12je5va"><!> <!></div>'),xo=M('<div class="week-view svelte-12je5va"><div class="week-header svelte-12je5va"><div class="svelte-12je5va"></div> <!></div> <div class="week-body svelte-12je5va"><div class="time-column svelte-12je5va"></div> <!></div></div>'),No=M('<div class="svelte-12je5va"> </div>'),Po=M('<button type="button"><span class="svelte-12je5va"> </span></button>'),$o=M("<div></div>"),Fo=M('<section><div class="month-card__header svelte-12je5va"><span class="month-card__label svelte-12je5va"> </span></div> <div class="month-card__weekday-row svelte-12je5va"></div> <div class="month-card__weeks svelte-12je5va"></div></section>'),Oo=M('<div class="month-view svelte-12je5va"></div>'),Uo=M('<option class="svelte-12je5va"></option>'),Yo=M('<div class="modal-helper-text svelte-12je5va">Caricamento pazienti…</div>'),Ro=M('<button class="modal-secondary-button modal-inline-button svelte-12je5va" type="button"> </button>'),Ho=M('<button class="modal-secondary-button modal-inline-button svelte-12je5va" type="button"> </button>'),Vo=M('<option class="svelte-12je5va"> </option>'),Wo=M('<option class="svelte-12je5va"></option>'),Bo=M('<div class="modal-helper-text svelte-12je5va">Caricamento indirizzi…</div>'),Zo=M('<option class="svelte-12je5va"></option>'),Ko=M('<div class="modal-helper-text svelte-12je5va">Caricamento prestazioni…</div>'),qo=M('<div class="modal-error svelte-12je5va" role="alert"> </div>'),Go=M('<button class="modal-secondary-button svelte-12je5va" type="button">Elimina</button> <button class="modal-submit svelte-12je5va" type="button">Modifica</button>',1),Jo=M('<button class="modal-submit svelte-12je5va" type="button"> </button>'),Xo=M('<div class="modal-error svelte-12je5va" role="alert"> </div>'),Qo=M('<div class="modal-confirm-backdrop svelte-12je5va" role="alertdialog" aria-modal="true" aria-live="assertive"><div class="modal-confirm svelte-12je5va"><p class="svelte-12je5va"> </p> <!> <div class="modal-confirm-buttons svelte-12je5va"><button type="button" class="modal-secondary-button svelte-12je5va">Annulla</button> <button type="button"> </button></div></div></div>'),es=M('<div class="modal-backdrop svelte-12je5va" role="button" tabindex="0" aria-label="Chiudi finestra di dialogo"><div class="modal svelte-12je5va" role="dialog" aria-modal="true" aria-labelledby="create-event-title"><div class="modal-header svelte-12je5va"><h2 id="create-event-title" class="svelte-12je5va"> </h2> <button class="modal-close nav-button svelte-12je5va" type="button" aria-label="Chiudi finestra"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="svelte-12je5va"><path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" fill="#5f6368" class="svelte-12je5va"></path></svg></button></div> <input class="modal-input svelte-12je5va" type="text" placeholder="Paziente" list="patient-options" autocomplete="off"> <datalist id="patient-options" class="svelte-12je5va"></datalist> <!> <div class="modal-row svelte-12je5va"><svg class="modal-icon svelte-12je5va" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M6.62 10.79C8.06 13.62 10.38 15.94 13.21 17.38L15.27 15.32C15.66 14.93 16.26 14.82 16.77 15C18.21 15.5 19.8 15.78 21.5 15.78C22.33 15.78 23 16.45 23 17.28V21.5C23 22.33 22.33 23 21.5 23C11.28 23 3 14.72 3 4.5C3 3.67 3.67 3 4.5 3H8.72C9.55 3 10.22 3.67 10.22 4.5C10.22 6.2 10.5 7.79 11 9.23C11.18 9.74 11.07 10.34 10.68 10.73L8.62 12.79C8.82 13.17 9.03 13.54 9.25 13.9Z" fill="#5f6368" class="svelte-12je5va"></path></svg> <input class="modal-text-input svelte-12je5va" type="tel" placeholder="Telefono"></div> <!> <div class="modal-row svelte-12je5va"><svg class="modal-icon svelte-12je5va" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M11.99 2C6.47 2 2 6.48 2 12C2 17.52 6.47 22 11.99 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 11.99 2ZM12 20C7.58 20 4 16.42 4 12C4 7.58 7.58 4 12 4C16.42 4 20 7.58 20 12C20 16.42 16.42 20 12 20ZM12.5 7H11V13L16.25 16.15L17 14.92L12.5 12.25V7Z" fill="#5f6368" class="svelte-12je5va"></path></svg> <div class="modal-datetime svelte-12je5va"><label class="modal-field svelte-12je5va"><span class="modal-label svelte-12je5va">Giorno</span> <select class="modal-select svelte-12je5va"></select></label> <div class="modal-time-wrapper svelte-12je5va"><label class="modal-field svelte-12je5va"><span class="modal-label svelte-12je5va">Inizio</span> <input class="modal-time svelte-12je5va" type="time" step="300"></label> <span class="modal-time-separator svelte-12je5va">–</span> <label class="modal-field svelte-12je5va"><span class="modal-label svelte-12je5va">Fine</span> <input class="modal-time svelte-12je5va" type="time" step="300"></label></div> <label class="modal-checkbox svelte-12je5va"><input id="all-day" type="checkbox" class="svelte-12je5va"> <span class="svelte-12je5va">Tutto il giorno</span></label></div></div> <div class="modal-row svelte-12je5va"><svg class="modal-icon svelte-12je5va" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z" fill="#5f6368" class="svelte-12je5va"></path></svg> <input class="modal-text-input svelte-12je5va" type="text" placeholder="Luogo" list="luogo-options" autocomplete="off"> <datalist id="luogo-options" class="svelte-12je5va"></datalist> <!></div> <div class="modal-row svelte-12je5va"><svg class="modal-icon svelte-12je5va" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M15 12C17.21 12 19 10.21 19 8C19 5.79 17.21 4 15 4C12.79 4 11 5.79 11 8C11 10.21 12.79 12 15 12ZM15 6C16.1 6 17 6.9 17 8C17 9.1 16.1 10 15 10C13.9 10 13 9.1 13 8C13 6.9 13.9 6 15 6ZM15 14C12.33 14 7 15.34 7 18V20H23V18C23 15.34 17.67 14 15 14ZM9 18C9.22 17.28 12.31 16 15 16C17.7 16 20.8 17.29 21 18H9ZM6 15V12H9V10H6V7H4V10H1V12H4V15H6Z" fill="#5f6368" class="svelte-12je5va"></path></svg> <input class="modal-text-input svelte-12je5va" type="text" placeholder="Prestazione" list="prestazione-options" autocomplete="off"> <datalist id="prestazione-options" class="svelte-12je5va"></datalist> <!></div> <div class="modal-row svelte-12je5va"><svg class="modal-icon svelte-12je5va" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M20.41 4.94L19.06 3.58C18.68 3.2 18.12 3.2 17.74 3.58L16.73 4.59L19.4 7.26L20.41 6.25C20.79 5.87 20.79 5.32 20.41 4.94ZM3.87 17.45L3 21L6.54 20.13L17.47 9.2L14.8 6.53L3.87 17.45Z" fill="#5f6368" class="svelte-12je5va"></path></svg> <input class="modal-text-input svelte-12je5va" type="text" placeholder="Aggiungi descrizione"></div> <!> <div class="modal-actions svelte-12je5va"><div class="modal-calendar-picker svelte-12je5va"><div class="modal-calendar-color svelte-12je5va"></div> <span class="svelte-12je5va">Il mio calendario</span> <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="svelte-12je5va"><path d="M7 10L12 15L17 10H7Z" fill="#5f6368" class="svelte-12je5va"></path></svg></div> <div class="modal-action-buttons svelte-12je5va"><!></div></div> <!></div></div>'),ts=M('<div class="container svelte-12je5va"><div class="calendar-container svelte-12je5va"><div class="calendar-header svelte-12je5va"><div class="view-options svelte-12je5va"><button class="today-button svelte-12je5va" type="button">Oggi</button> <div class="month-navigation svelte-12je5va"><button class="nav-button svelte-12je5va" type="button"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="svelte-12je5va"><path d="M15.41 7.41L14 6L8 12L14 18L15.41 16.59L10.83 12L15.41 7.41Z" fill="#5f6368" class="svelte-12je5va"></path></svg></button> <button class="nav-button svelte-12je5va" type="button"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="svelte-12je5va"><path d="M10 6L8.59 7.41L13.17 12L8.59 16.59L10 18L16 12L10 6Z" fill="#5f6368" class="svelte-12je5va"></path></svg></button> <span class="current-month svelte-12je5va"> </span></div></div> <div class="view-tabs svelte-12je5va"><button type="button">Settimana</button> <button type="button">Mese</button></div> <div class="header-actions svelte-12je5va"><button class="add-event-button svelte-12je5va" type="button" aria-haspopup="dialog">+</button> <button class="logout-button svelte-12je5va" type="button">Esci</button></div></div> <!> <!> <!></div></div> <!>',1),as=M('<div class="svelte-12je5va"><!></div>');function cs(r,s){Vn(s,!1);const o=y(),i=48/60,c=6,p=24,m=Array.from({length:p-c},(e,n)=>c+n),k=m.map(e=>`${e.toString().padStart(2,"0")}:00`),q=["blue"],B="calendar-auth-token",O="calendar-auth-token-expiry",Ye=24*60*60*1e3,T=[{short:"LUN",long:"Lunedì"},{short:"MAR",long:"Martedì"},{short:"MER",long:"Mercoledì"},{short:"GIO",long:"Giovedì"},{short:"VEN",long:"Venerdì"},{short:"SAB",long:"Sabato"},{short:"DOM",long:"Domenica"}],N=["gennaio","febbraio","marzo","aprile","maggio","giugno","luglio","agosto","settembre","ottobre","novembre","dicembre"];let _=y(!1),ce=y(""),W=y(""),G=y(!1),z=y([]),Z=y([]),C=y(""),D=y(!1),Qe=y(""),P=y(!1),j=y(""),Re=y("create"),ge=null,$=y(null),K=y(!1),re=y("week"),De=lt(new Date);De.getFullYear();let ye=y(!1),_e=y("0"),ve=y("09:00"),ne=y("10:00"),be=y(!1),He=y(""),et=y(""),tt=y(""),ft=y(""),Ee={start:"09:00",end:"10:00"},St=y([]),de=y(null),xe="",J=y(""),Ne=y(""),at=y(!1),Ve=y(!1),Mt=y([]),Tt=y([]),Ot=y(!1),Ut=y(!1),Yt=y(!1),rt=null,nt=null,ot=null,st=y(lt(new Date)),fe=y(it(t(st))),pa=y([]),ma=y(""),Dt=y(null);const sr=e=>{typeof localStorage>"u"||(localStorage.setItem(B,e),localStorage.setItem(O,String(Date.now()+Ye)))},ht=()=>{typeof localStorage<"u"&&(localStorage.removeItem(B),localStorage.removeItem(O)),ca(null)},je=(e="Sessione scaduta. Effettua di nuovo il login.")=>{a(W,e),a(_,!1),a(ye,!1),ht()},ir=()=>{if(typeof localStorage>"u"){a(_,!1);return}const e=localStorage.getItem(B),n=localStorage.getItem(O);if(!e||!n){ht(),a(_,!1);return}const d=Number(n);if(!Number.isFinite(d)||d<=Date.now()){ht(),a(_,!1);return}ca(e),a(_,!0),Pe(new Date)},lr=()=>{a(z,[]),a(Z,[]),a(C,""),a(ye,!1),a(j,""),a(ce,""),a(W,""),ht(),a(_,!1)},ke=e=>e instanceof fa,cr=async e=>{if(e.preventDefault(),!t(G)){a(G,!0),a(W,"");try{const n=await fo(t(ce).trim());ca(n),sr(n),a(_,!0),a(ce,""),await Pe(new Date)}catch(n){n instanceof Error?a(W,n.message):a(W,"Accesso non riuscito"),ht()}finally{a(G,!1)}}},We=e=>{const[n,d]=e.split(":").map(Number);return n*60+(d??0)},vr=e=>typeof e=="string"?e.trim():"";lt(new Date);function it(e){return new Date(e.getFullYear(),0,1)}const dr=e=>{const n=We(e.hourStart),d=We(e.hourEnd),f=c*60,b=p*60,w=Math.max(n,f),E=Math.min(d,b);if(E<=w)return"display: none;";const U=Math.max((E-w)*i,24);return`top: ${(w-f)*i}px; height: ${U}px; width: calc(100% - 6px);`},ur=(e,n)=>q[(e+n)%q.length],ga=e=>e.patientName||(e.patientId?`Paziente #${e.patientId}`:"")||e.tipoPrestazione||"Evento",fr=e=>{const n=`${e.hourStart} - ${e.hourEnd}`;return e.tipoPrestazione?`${n} · ${e.tipoPrestazione}`:n};function _a(e){const n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),d=n.getUTCDay()||7;n.setUTCDate(n.getUTCDate()+4-d);const f=n.getUTCFullYear(),b=new Date(Date.UTC(f,0,1)),w=Math.ceil(((n.getTime()-b.getTime())/864e5+1)/7),E=new Date(Date.UTC(f,0,4)),U=E.getUTCDay()||7,Y=new Date(E);Y.setUTCDate(E.getUTCDate()-U+1);const R=new Date(Y);R.setUTCDate(Y.getUTCDate()+(w-1)*7);const Le=new Date(R.getUTCFullYear(),R.getUTCMonth(),R.getUTCDate());return{week:w,year:f,weekStart:Le}}function lt(e){return _a(e).weekStart}const Lt=(e,n)=>{const d=new Date(e);return d.setDate(d.getDate()+n),d},ba=e=>{const n=e.getFullYear(),d=`${e.getMonth()+1}`.padStart(2,"0"),f=`${e.getDate()}`.padStart(2,"0");return`${n}-${d}-${f}`},zt=(e,n)=>e.getFullYear()===n.getFullYear()&&e.getMonth()===n.getMonth()&&e.getDate()===n.getDate(),hr=e=>({id:e.id,hourStart:e.hour_start,hourEnd:e.hour_end,patientId:typeof e.paziente=="number"?e.paziente:null,patientName:typeof e.paziente_nome=="string"?e.paziente_nome:typeof e.paziente=="string"?e.paziente:"",patientPhone:typeof e.paziente_telefono=="string"?e.paziente_telefono:null,tipoPrestazione:typeof e.tipo_prestazione=="string"?e.tipo_prestazione:"",luogo:typeof e.luogo=="string"?e.luogo:"",descrizione:vr(e.descrizione)}),wa=(e,n)=>{const d=new Map(n.map(f=>[f.date,Array.isArray(f.events)?f.events:[]]));return Array.from({length:7},(f,b)=>{const w=T[b],E=Lt(e,b),U=ba(E),Y=d.get(U)??[];return{isoDate:U,date:E,dayNumber:E.getDate(),shortLabel:w.short,longLabel:w.long,fullLabel:`${w.long} ${E.getDate()} ${N[E.getMonth()]}`,isToday:zt(E,new Date),events:Y.map(hr)}})},pr=T.map(e=>e.short),mr=(e,n)=>new Date(e.getFullYear(),e.getMonth()+n,1),ya=(e,n)=>new Date(e.getFullYear()+n,e.getMonth(),e.getDate()),Ea=(e,n)=>zt(lt(e),lt(n)),ja=e=>`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}`,gr=(e,n)=>{const d=new Date(e.getFullYear(),e.getMonth(),1),f=lt(d),b=[];let w=new Date(f);for(let E=0;E<6;E++){const U=[];for(let Y=0;Y<7;Y++){const R=Lt(w,Y+E*7),Le=ba(R),pt=zt(R,new Date),mt=R.getMonth()===e.getMonth(),gt=Ea(R,new Date),xt=Ea(R,n);U.push({date:R,isoDate:Le,dayNumber:R.getDate(),isCurrentMonth:mt,isToday:pt,isTodayWeek:gt,isLastViewedWeek:xt})}b.push({id:`${e.getFullYear()}-${e.getMonth()}-${E}`,days:U,isTodayWeek:U.some(Y=>Y.isTodayWeek),isLastViewedWeek:U.some(Y=>Y.isLastViewedWeek)})}return b},_r=(e,n)=>{const d=it(e),f=[],b=new Date;for(let w=0;w<12;w++){const E=mr(d,w);f.push({id:ja(E),label:`${N[E.getMonth()]} ${E.getFullYear()}`,monthIndex:E.getMonth(),year:E.getFullYear(),weeks:gr(E,n),isCurrentMonth:E.getMonth()===b.getMonth()&&E.getFullYear()===b.getFullYear()})}return f},Rt=async e=>{if(await Kn(),t(re)!=="month"||!t(Dt))return;const n=t(Dt).querySelector(`[data-month-id="${ja(e)}"]`);n instanceof HTMLElement&&n.scrollIntoView({behavior:"smooth",block:"start"})},ka=async()=>{const e=new Set;for(const n of t(z))for(const d of n.events)d.patientId&&!d.patientName&&e.add(d.patientId);if(e.size!==0)try{const n=await Ka(Array.from(e)),d=new Map(n.map(f=>[f.id,f]));a(z,t(z).map(f=>({...f,events:f.events.map(b=>{if(!b.patientId)return b;const w=d.get(b.patientId);return w?{...b,patientName:w.nome,patientPhone:w.telefono??null}:b})})))}catch(n){ke(n)?je(n.message):console.error("Errore caricamento dettagli pazienti",n)}},br=e=>{if(e.length===0)return"";const n=e[0],d=e[e.length-1],f=N[n.date.getMonth()],b=N[d.date.getMonth()];return n.date.getFullYear()===d.date.getFullYear()?n.date.getMonth()===d.date.getMonth()?`${n.dayNumber} - ${d.dayNumber} ${f} ${n.date.getFullYear()}`:`${n.dayNumber} ${f} - ${d.dayNumber} ${b} ${d.date.getFullYear()}`:`${n.dayNumber} ${f} ${n.date.getFullYear()} - ${d.dayNumber} ${b} ${d.date.getFullYear()}`},Ca=()=>{const e=new Date,n=t(z).findIndex(d=>zt(d.date,e));return n===-1?0:n},wr=()=>{if(!t(z).length){a(_e,"0");return}const e=Number(t(_e));Number.isInteger(e)&&t(z)[e]||a(_e,String(Ca()))},Pe=async e=>{if(!t(_))return;let n=!1;const{week:d,year:f,weekStart:b}=_a(e);De=b,a(D,!0),a(Qe,"");try{const w=await ho(f,d);a(z,wa(b,w)),await ka()}catch(w){if(ke(w)){n=!0,je(w.message),a(z,[]);return}a(Qe,w instanceof Error?w.message:"Impossibile caricare gli eventi"),a(z,wa(b,[])),await ka()}finally{if(n){a(D,!1);return}a(C,br(t(z))),a(Z,t(z).map(w=>w.fullLabel)),wr(),a(D,!1),a(st,new Date(b)),a(fe,it(b))}},yr=()=>{const e=Lt(De,-7);Pe(e)},Er=()=>{const e=Lt(De,7);Pe(e)},jr=()=>{Pe(new Date)},kr=()=>{a(re,"week")},Cr=()=>{a(fe,it(t(st))),a(re,"month"),Rt(t(st))},Sr=()=>{a(fe,it(ya(t(fe),-1))),Rt(t(fe))},Mr=()=>{a(fe,it(ya(t(fe),1))),Rt(t(fe))},Tr=e=>{a(re,"week"),Pe(e)},Dr=async e=>{try{const n=await Ka([e]);n.length>0&&At(n[0])}catch(n){ke(n)?je(n.message):console.error("Errore caricamento paziente",n)}},It=async e=>{a(Ot,!0);try{const[n,d]=await Promise.all([bo(e),Eo(e)]);if(a(St,n),e.trim().length>0){const f=d.find(b=>b.nome.toLowerCase()===e.trim().toLowerCase());f?At(f):t(de)&&xe!==e&&(a(de,null),xe="",a(J,""))}}catch(n){if(ke(n)){je(n.message),a(St,[]);return}console.error("Errore caricamento pazienti",n),a(St,[])}finally{a(Ot,!1)}},Ht=async e=>{a(Ut,!0);try{a(Mt,await wo(e))}catch(n){if(ke(n)){je(n.message),a(Mt,[]);return}console.error("Errore caricamento prestazioni",n),a(Mt,[])}finally{a(Ut,!1)}},Vt=async e=>{a(Yt,!0);try{a(Tt,await yo(e))}catch(n){if(ke(n)){je(n.message),a(Tt,[]);return}console.error("Errore caricamento luoghi",n),a(Tt,[])}finally{a(Yt,!1)}},Sa=e=>{rt&&clearTimeout(rt),xe&&xe!==e&&(a(de,null),xe="",a(J,"")),rt=setTimeout(()=>{It(e)},200)},At=e=>{a(de,e.id),xe=e.nome,a(He,e.nome),a(J,e.telefono??""),a(Ne,t(J)),a(Ve,!1)},Ma=e=>{nt&&clearTimeout(nt),nt=setTimeout(()=>{Ht(e)},200)},Ta=e=>{ot&&clearTimeout(ot),ot=setTimeout(()=>{Vt(e)},200)},Lr=async()=>{const e=t(He).trim();if(!e){a(j,"Inserisci il nome del paziente");return}a(at,!0),a(j,"");try{const n=await jo({nome:e,telefono:t(J).trim()?t(J).trim():null});At(n),await It(n.nome),a(Ne,n.telefono??"")}catch(n){if(ke(n)){je(n.message);return}a(j,n instanceof Error?n.message:"Impossibile creare il paziente")}finally{a(at,!1)}},zr=async()=>{if(t(de)){a(Ve,!0),a(j,"");try{const e=await ko(t(de),{telefono:t(J).trim()?t(J).trim():null});a(Ne,e.telefono??""),a(J,t(Ne)),At(e)}catch(e){if(ke(e)){je(e.message);return}a(j,e instanceof Error?e.message:"Impossibile aggiornare il paziente")}finally{a(Ve,!1)}}},Ir=()=>{a(_e,String(Ca())),a(ve,"09:00"),a(ne,"10:00"),Ee={start:t(ve),end:t(ne)},a(be,!1),a(He,""),a(de,null),xe="",a(J,""),a(Ne,""),a(Ve,!1),a(at,!1),a(et,""),a(tt,""),a(ft,""),a(j,"")},Ar=()=>{Ir(),a(Re,"create"),ge=null,a($,null),a(P,!1),a(K,!1),a(ye,!0),It(""),Ht(""),Vt("")},xr=(e,n)=>{a(_e,String(e)),n.hourStart==="00:00"&&n.hourEnd==="23:59"?(a(be,!0),a(ve,"00:00"),a(ne,"23:59"),Ee={start:"09:00",end:"10:00"}):(a(be,!1),a(ve,n.hourStart),a(ne,n.hourEnd),Ee={start:n.hourStart,end:n.hourEnd}),a(He,n.patientName),a(de,n.patientId),xe=n.patientName,a(J,n.patientPhone??""),a(Ne,t(J)),a(Ve,!1),n.patientId&&!n.patientName&&Dr(n.patientId),a(et,n.luogo),a(tt,n.tipoPrestazione),a(ft,n.descrizione??""),a(j,"")},Nr=(e,n)=>{a(Re,"edit"),ge=n.id,a($,null),a(P,!1),a(K,!1),xr(e,n),a(ye,!0),It(n.patientName??""),Ht(n.tipoPrestazione),Vt(n.luogo)},Je=()=>{a(ye,!1),a(Re,"create"),ge=null,a($,null),a(P,!1),a(K,!1),a(at,!1),a(Ve,!1),a(j,""),a(de,null),xe="",a(J,""),a(Ne,""),rt&&(clearTimeout(rt),rt=null),nt&&(clearTimeout(nt),nt=null),ot&&(clearTimeout(ot),ot=null)},Pr=e=>{e.key==="Escape"&&t(ye)&&Je()},$r=e=>{const n=e.currentTarget;if(!n)return;const d=n.checked;d?(Ee={start:t(ve),end:t(ne)},a(ve,"00:00"),a(ne,"23:59")):(a(ve,Ee.start||"09:00"),a(ne,Ee.end||"10:00")),a(be,d)},Fr=(e,n)=>{const[d,f]=e.split(":").map(Number),b=d*60+(f??0)+n,w=Math.min(Math.max(b,0),23*60+59),E=Math.floor(w/60),U=w%60;return`${E.toString().padStart(2,"0")}:${U.toString().padStart(2,"0")}`},Or=e=>{if(a(ve,e),t(be))Ee={...Ee,start:e};else{const n=Fr(e,60);a(ne,n),Ee={start:e,end:n}}},Ur=e=>{a(ne,e),t(be)||(Ee={...Ee,end:e})},Yr=(e,n)=>{const d=We(e);return We(n)>d},Rr=e=>{const n=[];return e.tipo_prestazione.trim()||n.push("Inserisci la prestazione"),e.luogo.trim()||n.push("Inserisci il luogo"),!t(be)&&!Yr(e.hour_start,e.hour_end)&&n.push("L'orario di fine deve essere successivo all'inizio"),n},Da=(e,n,d,f)=>{const b=We(n),w=We(d);return e.events.some(E=>{if(f&&E.id===f)return!1;const U=We(E.hourStart),Y=We(E.hourEnd);return b<Y&&w>U})},La=()=>{if(a(j,""),!t(z).length)return a(j,"Carica prima una settimana"),null;const e=Number(t(_e));if(!Number.isInteger(e)||!t(z)[e])return a(j,"Seleziona un giorno valido"),null;if(!t(de))return a(j,"Seleziona o crea un paziente"),null;const n=t(z)[e],d=t(ft).trim(),f={data:n.isoDate,hour_start:t(be)?"00:00":t(ve),hour_end:t(be)?"23:59":t(ne),paziente:t(de),tipo_prestazione:t(tt).trim(),luogo:t(et).trim(),descrizione:d||" "},b=Rr(f);return b.length>0?(a(j,b.join(" · ")),null):{payload:f,selectedDay:n,dayIndex:e}},Hr=async()=>{if(t(P))return;const e=La();if(!e)return;const{payload:n,selectedDay:d}=e;if(Da(d,n.hour_start,n.hour_end)){a(j,"Esiste già un appuntamento in questo intervallo orario");return}a(P,!0);try{await po(n),await Pe(De),Je()}catch(f){if(ke(f)){je(f.message);return}a(j,f instanceof Error?f.message:"Impossibile creare l'evento")}finally{a(P,!1)}},Vr=async()=>{if(t(P)||t(K))return;if(!ge){a(j,"Evento non valido"),a($,null);return}const e=La();if(!e){a($,null);return}const{payload:n,selectedDay:d}=e;if(Da(d,n.hour_start,n.hour_end,ge)){a(j,"Esiste già un appuntamento in questo intervallo orario"),a($,null);return}a(P,!0);try{await mo({id:ge,...n}),await Pe(De),Je()}catch(f){if(ke(f)){je(f.message);return}a(j,f instanceof Error?f.message:"Impossibile aggiornare l'evento")}finally{a(P,!1),a($,null)}},Wr=async()=>{if(!(t(P)||t(K))){if(!ge){a(j,"Evento non valido"),a($,null);return}a(K,!0);try{await go(ge),await Pe(De),Je()}catch(e){if(ke(e)){je(e.message);return}a(j,e instanceof Error?e.message:"Impossibile eliminare l'evento")}finally{a(K,!1),a($,null)}}},za=e=>{t(P)||t(K)||(a(j,""),a($,e))},Br=()=>{t(P)||t(K)||a($,null)},Zr=async()=>{t($)==="update"?await Vr():t($)==="delete"&&await Wr()};eo(()=>{ir()}),oa(()=>(t(de),t(J),t(Ne)),()=>{a(o,t(de)!==null&&t(J).trim()!==t(Ne).trim())}),oa(()=>(t(fe),t(st)),()=>{a(pa,_r(t(fe),t(st)))}),oa(()=>t(fe),()=>{a(ma,`Anno ${t(fe).getFullYear()}`)}),Wn(),bn();var Wt=as();L("keydown",Zn,Pr);var Kr=u(Wt);{var qr=e=>{var n=So(),d=u(n),f=h(u(d),4),b=h(u(f),2);Oe(b),v(f);var w=h(f,2);{var E=R=>{var Le=Co(),pt=u(Le,!0);v(Le),x(()=>V(pt,t(W))),S(R,Le)};le(w,R=>{t(W)&&R(E)})}var U=h(w,2),Y=u(U,!0);v(U),v(d),v(n),x(()=>{U.disabled=t(G),V(Y,t(G)?"Accesso…":"Accedi")}),qe(b,()=>t(ce),R=>a(ce,R)),L("submit",d,vo(cr)),S(e,n)},Gr=e=>{var n=ts(),d=sa(n),f=u(d),b=u(f),w=u(b),E=u(w),U=h(E,2),Y=u(U),R=h(Y,2),Le=h(R,2),pt=u(Le,!0);v(Le),v(U),v(w);var mt=h(w,2),gt=u(mt);let xt;var Ia=h(gt,2);let Aa;v(mt);var xa=h(mt,2),Nt=u(xa),Jr=h(Nt,2);v(xa),v(b);var Na=h(b,2);{var Xr=H=>{var I=Mo(),ee=u(I,!0);v(I),x(()=>V(ee,t(Qe))),S(H,I)};le(Na,H=>{t(Qe)&&H(Xr)})}var Pa=h(Na,2);{var Qr=H=>{var I=To();S(H,I)};le(Pa,H=>{t(D)&&H(Qr)})}var en=h(Pa,2);{var tn=H=>{var I=xo(),ee=u(I),Ce=h(u(ee),2);me(Ce,1,()=>t(z),X=>X.isoDate,(X,oe)=>{var Q=Do();let te;var ae=u(Q),se=u(ae,!0);v(ae);var pe=h(ae,2),ie=u(pe,!0);v(pe),v(Q),x(()=>{te=Ke(Q,1,"day-header svelte-12je5va",null,te,{today:t(oe).isToday}),V(se,t(oe).shortLabel),V(ie,t(oe).dayNumber)}),S(X,Q)}),v(ee);var he=h(ee,2),$e=u(he);me($e,5,()=>k,Fe,(X,oe)=>{var Q=Lo(),te=u(Q,!0);v(Q),x(()=>V(te,t(oe))),S(X,Q)}),v($e);var ct=h($e,2);me(ct,3,()=>t(z),X=>X.isoDate,(X,oe,Q)=>{var te=Ao(),ae=u(te);me(ae,1,()=>m,Fe,(pe,ie)=>{var Se=zo();S(pe,Se)});var se=h(ae,2);me(se,1,()=>t(oe).events,Fe,(pe,ie,Se)=>{var ue=Io(),Be=u(ue),_t=u(Be,!0);v(Be);var vt=h(Be,2),bt=u(vt,!0);v(vt),v(ue),x((wt,dt,Pt,ut,$t)=>{Ke(ue,1,wt,"svelte-12je5va"),Me(ue,"style",dt),Me(ue,"aria-label",Pt),V(_t,ut),V(bt,$t)},[()=>`event-card ${ur(t(Q),Se)}`,()=>dr(t(ie)),()=>`Modifica evento ${ga(t(ie))}`,()=>ga(t(ie)),()=>fr(t(ie))],Ft),L("click",ue,()=>Nr(t(Q),t(ie))),S(pe,ue)}),v(te),S(X,te)}),v(he),v(I),x(()=>Me(I,"aria-busy",t(D)?"true":"false")),S(H,I)},an=H=>{var I=Oo();me(I,5,()=>t(pa),ee=>ee.id,(ee,Ce)=>{var he=Fo(),$e=u(he),ct=u($e),X=u(ct,!0);v(ct),v($e);var oe=h($e,2);me(oe,5,()=>pr,Fe,(te,ae)=>{var se=No(),pe=u(se,!0);v(se),x(()=>V(pe,t(ae))),S(te,se)}),v(oe);var Q=h(oe,2);me(Q,5,()=>t(Ce).weeks,te=>te.id,(te,ae)=>{var se=$o();me(se,5,()=>t(ae).days,Fe,(pe,ie)=>{var Se=Po(),ue=u(Se),Be=u(ue,!0);v(ue),v(Se),x(()=>{Ke(Se,1,`month-day ${t(ie).isCurrentMonth?"":"month-day--faded"} ${t(ie).isToday?"month-day--today":""}`,"svelte-12je5va"),V(Be,t(ie).dayNumber)}),L("click",Se,()=>Tr(t(ie).date)),S(pe,Se)}),v(se),x(()=>Ke(se,1,`month-week ${t(ae).isTodayWeek?"month-week--today":""} ${t(ae).isLastViewedWeek?"month-week--last":""}`,"svelte-12je5va")),S(te,se)}),v(Q),v(he),x(()=>{Ke(he,1,`month-card ${t(Ce).isCurrentMonth?"month-card--current":""}`,"svelte-12je5va"),Me(he,"data-month-id",t(Ce).id),Me(he,"aria-label",`Calendario ${t(Ce).label}`),V(X,t(Ce).label)}),S(ee,he)}),v(I),Qn(I,ee=>a(Dt,ee),()=>t(Dt)),x(ee=>Me(I,"aria-label",ee),[()=>`Anno ${t(fe).getFullYear()}`],Ft),S(H,I)};le(en,H=>{t(re)==="week"?H(tn):H(an,!1)})}v(f),v(d);var rn=h(d,2);{var nn=H=>{var I=es(),ee=u(I),Ce=u(ee),he=u(Ce),$e=u(he,!0);v(he);var ct=h(he,2);v(Ce);var X=h(Ce,2);Oe(X);var oe=h(X,2);me(oe,5,()=>t(St),Fe,(l,g)=>{var A=Uo(),F={};x(()=>{F!==(F=t(g))&&(A.value=(A.__value=t(g))==null?"":t(g))}),S(l,A)}),v(oe);var Q=h(oe,2);{var te=l=>{var g=Yo();S(l,g)};le(Q,l=>{t(Ot)&&l(te)})}var ae=h(Q,2),se=h(u(ae),2);Oe(se),v(ae);var pe=h(ae,2);{var ie=l=>{var g=Ro(),A=u(g,!0);v(g),x(()=>{g.disabled=t(at),V(A,t(at)?"Creazione paziente…":"Aggiungi paziente")}),L("click",g,Lr),S(l,g)},Se=l=>{var g=_n(),A=sa(g);{var F=Ze=>{var ze=Ho(),Xe=u(ze,!0);v(ze),x(()=>{ze.disabled=t(Ve),V(Xe,t(Ve)?"Aggiornamento…":"Aggiorna telefono")}),L("click",ze,zr),S(Ze,ze)};le(A,Ze=>{t(o)&&Ze(F)},!0)}S(l,g)};le(pe,l=>{!t(de)&&t(He).trim().length>0?l(ie):l(Se,!1)})}var ue=h(pe,2),Be=h(u(ue),2),_t=u(Be),vt=h(u(_t),2);x(()=>{t(_e),qn(()=>{t(Z)})}),me(vt,5,()=>t(Z),Fe,(l,g,A)=>{var F=Vo(),Ze={},ze=u(F,!0);v(F),x(Xe=>{Ze!==(Ze=Xe)&&(F.value=(F.__value=Xe)==null?"":Xe),V(ze,t(g))},[()=>String(A)],Ft),S(l,F)}),v(vt),v(_t);var bt=h(_t,2),wt=u(bt),dt=h(u(wt),2);Oe(dt),v(wt);var Pt=h(wt,4),ut=h(u(Pt),2);Oe(ut),v(Pt),v(bt);var $t=h(bt,2),Bt=u($t);Oe(Bt),Gn(2),v($t),v(Be),v(ue);var Zt=h(ue,2),yt=h(u(Zt),2);Oe(yt);var Kt=h(yt,2);me(Kt,5,()=>t(Tt),Fe,(l,g)=>{var A=Wo(),F={};x(()=>{F!==(F=t(g))&&(A.value=(A.__value=t(g))==null?"":t(g))}),S(l,A)}),v(Kt);var on=h(Kt,2);{var sn=l=>{var g=Bo();S(l,g)};le(on,l=>{t(Yt)&&l(sn)})}v(Zt);var qt=h(Zt,2),Et=h(u(qt),2);Oe(Et);var Gt=h(Et,2);me(Gt,5,()=>t(Mt),Fe,(l,g)=>{var A=Zo(),F={};x(()=>{F!==(F=t(g))&&(A.value=(A.__value=t(g))==null?"":t(g))}),S(l,A)}),v(Gt);var ln=h(Gt,2);{var cn=l=>{var g=Ko();S(l,g)};le(ln,l=>{t(Ut)&&l(cn)})}v(qt);var Jt=h(qt,2),$a=h(u(Jt),2);Oe($a),v(Jt);var Fa=h(Jt,2);{var vn=l=>{var g=qo(),A=u(g,!0);v(g),x(()=>V(A,t(j))),S(l,g)};le(Fa,l=>{t(j)&&!t($)&&l(vn)})}var Xt=h(Fa,2),Oa=h(u(Xt),2),dn=u(Oa);{var un=l=>{var g=Go(),A=sa(g),F=h(A,2);x(()=>{A.disabled=t(P)||t(K),F.disabled=t(P)||t(K)}),L("click",A,()=>za("delete")),L("click",F,()=>za("update")),S(l,g)},fn=l=>{var g=Jo(),A=u(g,!0);v(g),x(()=>{g.disabled=t(P),V(A,t(P)?"Salvataggio…":"Salva")}),L("click",g,Hr),S(l,g)};le(dn,l=>{t(Re)==="edit"?l(un):l(fn,!1)})}v(Oa),v(Xt);var hn=h(Xt,2);{var pn=l=>{var g=Qo(),A=u(g),F=u(A),Ze=u(F,!0);v(F);var ze=h(F,2);{var Xe=ea=>{var ta=Xo(),gn=u(ta,!0);v(ta),x(()=>V(gn,t(j))),S(ea,ta)};le(ze,ea=>{t(j)&&ea(Xe)})}var Ua=h(ze,2),Qt=u(Ua),jt=h(Qt,2),mn=u(jt,!0);v(jt),v(Ua),v(A),v(g),x(()=>{V(Ze,t($)==="delete"?"Sei sicuro di voler eliminare questo evento?":"Sei sicuro di voler salvare le modifiche?"),Qt.disabled=t(P)||t(K),Ke(jt,1,`modal-submit ${t($)==="delete"?"modal-submit--danger":""}`,"svelte-12je5va"),jt.disabled=t(P)||t(K),V(mn,t($)==="delete"?t(K)?"Eliminazione…":"Conferma eliminazione":t(P)?"Salvataggio…":"Conferma modifiche")}),L("click",Qt,Br),L("click",jt,Zr),S(l,g)};le(hn,l=>{t($)&&l(pn)})}v(ee),v(I),x(()=>{V($e,t(Re)==="edit"?"Modifica evento":"Aggiungi evento"),dt.disabled=t(be),ut.disabled=t(be),oo(Bt,t(be))}),L("click",ct,Je),qe(X,()=>t(He),l=>a(He,l)),L("input",X,l=>Sa(l.currentTarget.value)),L("focus",X,()=>Sa(t(He))),qe(se,()=>t(J),l=>a(J,l)),lo(vt,()=>t(_e),l=>a(_e,l)),qe(dt,()=>t(ve),l=>a(ve,l)),L("change",dt,l=>Or(l.currentTarget.value)),qe(ut,()=>t(ne),l=>a(ne,l)),L("change",ut,l=>Ur(l.currentTarget.value)),L("change",Bt,$r),qe(yt,()=>t(et),l=>a(et,l)),L("input",yt,l=>Ta(l.currentTarget.value)),L("focus",yt,()=>Ta(t(et))),qe(Et,()=>t(tt),l=>a(tt,l)),L("input",Et,l=>Ma(l.currentTarget.value)),L("focus",Et,()=>Ma(t(tt))),qe($a,()=>t(ft),l=>a(ft,l)),L("click",I,l=>{l.target===l.currentTarget&&Je()}),L("keydown",I,l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),Je())}),S(H,I)};le(rn,H=>{t(ye)&&H(nn)})}x(()=>{Me(Y,"aria-label",t(re)==="week"?"Settimana precedente":"Anno precedente"),Me(R,"aria-label",t(re)==="week"?"Settimana successiva":"Anno successivo"),V(pt,t(re)==="week"?t(C)||"Settimana non disponibile":t(ma)),xt=Ke(gt,1,"view-tab svelte-12je5va",null,xt,{active:t(re)==="week"}),Aa=Ke(Ia,1,"view-tab svelte-12je5va",null,Aa,{active:t(re)==="month"}),Me(Nt,"aria-expanded",t(ye)?"true":"false"),Nt.disabled=t(D)||t(z).length===0||t(re)!=="week"}),L("click",E,jr),L("click",Y,function(...H){var I;(I=t(re)==="week"?yr:Sr)==null||I.apply(this,H)}),L("click",R,function(...H){var I;(I=t(re)==="week"?Er:Mr)==null||I.apply(this,H)}),L("click",gt,kr),L("click",Ia,Cr),L("click",Nt,Ar),L("click",Jr,lr),S(e,n)};le(Kr,e=>{t(_)?e(Gr,!1):e(qr)})}v(Wt),S(r,Wt),Bn()}export{cs as component};
